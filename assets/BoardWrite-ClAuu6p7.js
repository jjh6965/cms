import{e as Z,u as ee,b as te,r as u,h as ne,j as t,f as M,c as y,d as C,i as se}from"./index-NQW_x_Sn.js";import{e as f}from"./errorMsgPopup-CX9GGfgq.js";import{m as L}from"./msgPopup-B5uV-LHr.js";import{s as o}from"./Board.module-DCwUm73g.js";import{f as i}from"./fileUtils-CySH9kI_.js";const ce=()=>{var z,R;const{state:n}=Z(),N=ee(),{user:I}=te(),r=!!(n!=null&&n.notice),P=(n==null?void 0:n.files)||[];u.useEffect(()=>(i.setAccept("*"),()=>{i.getAccept()}),[]);const D=P.map(e=>({...e,size:e.fileSize||0,isValid:i.isValidFile(e)})),$=D.length>=i.getMaxFiles()?[]:[{id:Date.now()}],[p,q]=u.useState(((z=n==null?void 0:n.notice)==null?void 0:z.title)||""),[x,B]=u.useState(((R=n==null?void 0:n.notice)==null?void 0:R.content)||""),[a,S]=u.useState($),[b,v]=u.useState(new Array($.length).fill(null)),[j,W]=u.useState(D),[F,w]=u.useState(!1);u.useEffect(()=>{if(!I||!ne(I.auth,"mainBoard")){N("/");return}},[I,N]);const _=()=>{j.length+a.length<i.getMaxFiles()&&(S([...a,{id:Date.now()}]),v([...b,null]))},G=e=>{const l=a.findIndex(s=>s.id===e);if(l!==-1){if(a.length>1){const s=a.filter(g=>g.id!==e),c=b.filter((g,d)=>d!==l);S(s),v(c);return}S([{id:Date.now()+1}]),v([null])}},H=async e=>{var l;if(window.confirm("파일을 삭제하시겠습니까?")){if(!r||!((l=n==null?void 0:n.notice)!=null&&l.id)){f("공지사항 ID가 존재하지 않습니다. 수정 모드에서만 파일 삭제가 가능합니다.");return}try{const s={gubun:"D",fileId:String(e.fileId),noticeId:String(n.notice.id)},c=await M(y,`${C.getServerUrl("notice/filedelete")}`,s);if(c.errCd!=="00")throw new Error(c.errMsg||"파일 삭제 실패");W(j.filter(d=>d.fileId!==e.fileId)),j.length-1+a.length<i.getMaxFiles()&&a.length===0&&(S([{id:Date.now()}]),v([null]))}catch(s){console.error("Error deleting file:",s),f(s.message||"파일 삭제 중 오류가 발생했습니다.")}}},J=(e,l)=>{const s=l.target.files[0];if(s){if(s.size>i.getMaxFileSize()){f(`파일 크기는 ${i.formatFileSize(i.getMaxFileSize())}를 초과할 수 없습니다.`);return}if(!i.isValidFile(s)){f("문서 파일(pdf, doc, docx, xls, xlsx, ppt, pptx)만 업로드 가능합니다.");return}const c=a.findIndex(d=>d.id===e);if(c===-1)return;const g=[...b];g[c]=s,v(g)}},K=async e=>{var d,U,k;e.preventDefault();const l=((d=n==null?void 0:n.notice)==null?void 0:d.title)||"",s=((U=n==null?void 0:n.notice)==null?void 0:U.content)||"";if(!r&&(!p||!x)||r&&p!==l&&!p||r&&x!==s&&!x){f("제목과 내용을 입력해주세요.");return}w(!0);try{const m=r?"U":"I",T=r?String(n.notice.id):"0",Q={gubun:m,noticeId:T,title:p,content:x},E=await M(y,`${C.getServerUrl("notice/save")}`,Q);if(E.errCd!=="00")throw new Error(E.errMsg||"공지사항 저장 실패");const X=r?T:(k=E.data)==null?void 0:k.noticeId,A=b.filter(h=>h!=null);if(A.length>0){const h=new FormData;h.append("gubun","I"),h.append("fileId",""),h.append("noticeId",X),A.forEach(Y=>{h.append("files",Y)});const V=await se(y,`${C.getServerUrl("notice/filesave")}`,h);if(V.errCd!=="00")throw new Error(V.errMsg||"파일 업로드 실패")}L(r?"공지사항이 성공적으로 변경되었습니다.":"공지사항이 성공적으로 등록되었습니다."),N("/main")}catch(m){console.error("공지사항 저장 실패:",{message:m.message,response:m.response?{status:m.response.status,data:m.response.data,headers:m.response.headers}:"No response received"}),f(m.message||"공지사항 저장 중 오류가 발생했습니다.")}finally{w(!1)}},O=async()=>{if(window.confirm("정말 삭제하시겠습니까?")){w(!0);try{const l={gubun:"D",noticeId:String(n.notice.id),title:p||"",content:x||""},s=await M(y,`${C.getServerUrl("notice/save")}`,l);if(s.errCd!=="00")throw new Error(s.errMsg||"공지사항 삭제 실패");L("공지사항이 성공적으로 삭제되었습니다."),N("/main")}catch(e){console.error("공지사항 삭제 실패:",e),f(e.message||"공지사항 삭제 중 오류가 발생했습니다.")}finally{w(!1)}}};return t.jsxs("div",{className:"container bg-body",children:[t.jsx("h2",{className:`text-primary text-dark fs-5 mb-4 pt-3 ${o.boardTitle}`,children:r?"공지 변경":"공지 등록"}),t.jsx("div",{className:o.boardTitleLine}),t.jsxs("form",{onSubmit:K,children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"제목"}),t.jsx("input",{className:`form-control bg-light-subtle ${o.formControl}`,value:p,onChange:e=>q(e.target.value),placeholder:"제목을 입력하세요",required:!0})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"내용"}),t.jsx("textarea",{className:`form-control bg-light-subtle ${o.formControl}`,rows:"5",value:x,onChange:e=>B(e.target.value),placeholder:"내용을 입력하세요",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"form-label",children:["첨부파일 ",t.jsxs("span",{className:"text-muted",children:["(최대 ",i.getMaxFiles(),"개까지만 첨부 가능하며, ",i.formatFileSize(i.getMaxFileSize()),"까지만 가능합니다. 문서 파일만 업로드 가능.)"]})]}),j.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("h6",{children:"기존 첨부파일:"}),j.map(e=>t.jsxs("div",{className:"d-flex align-items-center mb-2",children:[t.jsxs("span",{className:"me-2",children:[e.fileName," (",i.formatFileSize(e.size),")",!e.isValid&&t.jsx("span",{className:"text-danger ms-2",children:"(문서 파일이 아님)"})]}),t.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>H(e),children:"-"})]},e.fileId))]}),a&&a.length>0?a.map((e,l)=>t.jsxs("div",{className:"d-flex align-items-center mb-2",children:[t.jsx("input",{type:"file",className:`form-control bg-light-subtle ${o.formControl} me-2`,onChange:s=>J(e.id,s),accept:i.getAccept()}),t.jsx("button",{type:"button",className:"btn btn-outline-danger me-2",onClick:()=>G(e.id),children:"-"}),l===a.length-1&&t.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:_,disabled:j.length+a.length>=i.getMaxFiles(),children:"+"})]},e.id)):t.jsx("div",{}),b.some(e=>e!=null)&&t.jsxs("div",{className:"mt-3",children:[t.jsx("h6",{children:"선택된 파일:"}),t.jsx("ul",{children:b.map((e,l)=>e&&t.jsxs("li",{children:[e.name," (",i.formatFileSize(e.size),")"]},l))})]})]}),t.jsxs("div",{className:"btn-group-custom d-flex justify-content-end gap-2 mb-3 mt-5",children:[t.jsx("button",{type:"button",className:`btn ${o.btnCancel}`,onClick:()=>N("/main"),children:"취소"}),r?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"submit",className:`btn ${o.btnMod}`,disabled:F,children:F?"저장 중...":"변경"}),t.jsx("button",{type:"button",className:`btn btn-danger ${o.btnDel}`,onClick:O,disabled:F,children:F?"삭제 중...":"삭제"})]}):t.jsx("button",{type:"submit",className:`btn ${o.btnReg}`,disabled:F,children:F?"저장 중...":"등록"})]})]})]})};export{ce as default};
//# sourceMappingURL=BoardWrite-ClAuu6p7.js.map
