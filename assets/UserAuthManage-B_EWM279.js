import{b as Q,r as s,h as X,j as n,f as D,c as H,d as w}from"./index-NQW_x_Sn.js";import{i as k,M as Z,T as _}from"./TableSearch-D0PWM4AW.js";import{h as ee,c as te}from"./tableExcel-h_9-hs2N.js";import{s as c}from"./TableSearch.module-DFltd_EQ.js";import{C as re}from"./CommonPopup-Dwp1i3fD.js";import{e as d}from"./errorMsgPopup-CX9GGfgq.js";import{m as le}from"./msgPopup-B5uV-LHr.js";import"./DatePickerCommon-MvAA8I6u.js";import"./react-datepicker-D9fc_BLh.js";import"./index-BBx72Rax.js";const ae=m=>({GU:[{value:"ALL",label:"전체"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"ORGCD",label:"조직코드"},{value:"ORGNM",label:"조직명"},{value:"COMPANYCD",label:"회사코드"},{value:"COMPANYNM",label:"회사명"}]})[m]||[],ge=()=>{const{user:m}=Q(),b=s.useRef(null),i=s.useRef(null),S=s.useRef(!0),P={areas:[{type:"search",fields:[{id:"GU",type:"select",row:1,label:"구분",labelVisible:!0,options:ae("GU"),width:"150px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0},{id:"searchText",type:"text",row:1,label:"",labelVisible:!1,placeholder:"검색값을 입력하세요",maxLength:100,width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0}]}]},O=[{id:"filterSelect",label:"",type:"select",options:[{value:"",label:"선택"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"ORGCD",label:"조직코드"},{value:"ORGNM",label:"조직명"},{value:"COMPANYCD",label:"회사코드"},{value:"COMPANYNM",label:"회사명"},{value:"AUTHID",label:"권한ID"},{value:"AUTHNM",label:"권한명"}],width:"auto"},{id:"filterText",label:"",type:"text",placeholder:"검색값을 입력하세요",width:"200px"}],[C,j]=s.useState(k(P.areas.find(r=>r.type==="search").fields)),[v,F]=s.useState(k(O)),[A,f]=s.useState([]),[T,N]=s.useState([]),[h,g]=s.useState(!1),[p,U]=s.useState("initializing"),[G,M]=s.useState(!1),[I,y]=s.useState(null),[z,x]=s.useState({AUTHID:"",AUTHNM:""}),[Y,L]=s.useState(0),[R,$]=s.useState(!1);s.useEffect(()=>{(!m||!X(m.auth,"userAuthManage"))&&(window.location.href="/")},[m]),s.useEffect(()=>{(async()=>{var e,l;g(!0);try{const a={pGUBUN:"AUTHINFO",pSEARCH:"",pDEBUG:"F"},t=await D(H,`${w.getServerUrl("oper/usermng/list")}`,a);if(!t.success){d(t.message||"권한 데이터를 가져오는 중 오류가 발생했습니다."),N([]);return}if(t.errMsg!==""){d(t.errMsg),N([]);return}N(Array.isArray(t.data)?t.data:[])}catch(a){d(((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"권한 데이터를 가져오는 중 오류가 발생했습니다."),N([])}finally{g(!1)}})()},[]),s.useEffect(()=>((async()=>{if(await new Promise(e=>setTimeout(e,1e3)),!b.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(i.current=te(b.current,[{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업대상",field:"applyTarget",sorter:"string",width:100,formatter:e=>{const l=e.getRow().getData();let a=l.isChanged==="Y"?"변경":"";if(!a)return"";const t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.gap="5px";const o=document.createElement("input");o.type="checkbox",o.checked=l.isChanged==="Y",o.onclick=()=>{setTimeout(()=>{f(K=>K.map(E=>E.EMPNO===l.EMPNO?{...E,isChanged:o.checked?"Y":"N"}:E))},0)};const u=document.createElement("span");return u.innerText=a,t.appendChild(o),t.appendChild(u),t}},{headerHozAlign:"center",hozAlign:"center",title:"사원번호",field:"EMPNO",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"이름",field:"EMPNM",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"조직코드",field:"ORGCD",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"조직명",field:"ORGNM",sorter:"string",width:150,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"회사코드",field:"COMPANYCD",sorter:"string",width:100,editable:!1},{headerHozAlign:"center",hozAlign:"left",title:"회사명",field:"COMPANYNM",sorter:"string",width:150,editable:!1},{headerHozAlign:"center",hozAlign:"center",title:"권한ID",field:"AUTHID",sorter:"string",width:100,editable:!1,cellClick:(e,l)=>{y(l.getRow().getData().EMPNO),M(!0)},cellStyle:{backgroundColor:"#d3d3d3"}},{headerHozAlign:"center",hozAlign:"left",title:"권한명",field:"AUTHNM",sorter:"string",width:150,editable:!1,cellClick:(e,l)=>{y(l.getRow().getData().EMPNO),M(!0)},cellStyle:{backgroundColor:"#d3d3d3"}}],[],{editable:!1,rowFormatter:e=>{const l=e.getData(),a=e.getElement();a.classList.remove(c.editedRow),l.isChanged==="Y"&&a.classList.add(c.editedRow)}}),!i.current)throw new Error("createTable returned undefined or null");U("ready")}catch(e){U("error"),console.error("Table initialization failed:",e.message)}})(),()=>{i.current&&(i.current.destroy(),i.current=null,U("initializing"))}),[]),s.useEffect(()=>{var e;if(S.current){S.current=!1;return}const r=i.current;if(!(!r||p!=="ready"||h)&&(e=r.rowManager)!=null&&e.renderer)if(r.setData(A),R&&A.length===0&&!h)i.current.alert("검색 결과 없음","info");else{i.current.clearAlert();const l=i.current.getDataCount();L(l)}},[A,h,p,R]),s.useEffect(()=>{if(!i.current||p!=="ready"||h)return;const{filterSelect:r,filterText:e}=v;e&&r?i.current.setFilter(r,"like",e):e&&e!==""?i.current.setFilter([{field:"EMPNO",type:"like",value:e},{field:"EMPNM",type:"like",value:e},{field:"ORGCD",type:"like",value:e},{field:"ORGNM",type:"like",value:e},{field:"COMPANYCD",type:"like",value:e},{field:"COMPANYNM",type:"like",value:e},{field:"AUTHID",type:"like",value:e},{field:"AUTHNM",type:"like",value:e}],"or"):i.current.clearFilter()},[v,p,h]);const B=r=>{r==="search"&&V()},V=async()=>{var r,e;g(!0),$(!0);try{const l={pGUBUN:C.GU||"ALL",pSEARCH:C.searchText||"",pDEBUG:"F"},a=await D(H,`${w.getServerUrl("oper/usermng/list")}`,l);if(!a.success){d(a.message||"사용자 데이터를 가져오는 중 오류가 발생했습니다."),f([]);return}if(a.errMsg!==""){d(a.errMsg),f([]);return}const t=Array.isArray(a.data)?a.data:[];f(t.map(o=>({...o,isChanged:"N"})))}catch(l){d(((e=(r=l.response)==null?void 0:r.data)==null?void 0:e.message)||"사용자 데이터를 가져오는 중 오류가 발생했습니다."),f([])}finally{g(!1)}},W=()=>{if(!I)return;const r=z.AUTHID;f(e=>e.map(l=>{if(l.EMPNO===I){const a=T.find(t=>t.AUTHID===r);return{...l,AUTHID:r,AUTHNM:a?a.AUTHNM:"",isChanged:l.isChanged==="N"?"Y":l.isChanged}}return l})),i.current&&i.current.redraw(),M(!1),y(null),x({AUTHID:"",AUTHNM:""})},q=()=>{M(!1),y(null),x({AUTHID:"",AUTHNM:""})},J=async()=>{const r=A.filter(e=>e.isChanged==="Y");if(r.length===0){d("변경된 데이터가 없습니다.");return}g(!0);try{const e=r.map(async t=>{const o={pGUBUN:"I",pEMPNO:t.EMPNO,pAUTHID:t.AUTHID};try{const u=await D(H,`${w.getServerUrl("oper/usermng/save")}`,o);if(!u.success)throw new Error(u.message||`Failed to update user ${t.EMPNO}`);return{...t,success:!0}}catch(u){return console.error(`Error processing update for EMPNO: ${t.EMPNO}`,u),{...t,error:u.message}}}),a=(await Promise.all(e)).filter(t=>t==null?void 0:t.error);a.length>0?d(`일부 작업이 실패했습니다: ${a.map(t=>t.error).join(", ")}`):(le("모든 변경사항이 성공적으로 저장되었습니다."),f(t=>t.map(o=>({...o,isChanged:"N"}))))}catch(e){d(e.message||"저장 중 오류가 발생했습니다.")}finally{g(!1)}};return n.jsxs("div",{className:c.container,children:[n.jsx(Z,{config:P,filters:C,setFilters:j,onEvent:B}),n.jsx(_,{filterFields:O,filters:v,setFilters:F,rowCount:Y,onDownloadExcel:()=>ee(i.current,p,"사용자권한관리.xlsx"),buttonStyles:c,children:n.jsx("div",{className:c.btnGroupCustom,children:n.jsx("button",{className:`${c.btn} text-bg-success`,onClick:J,children:"저장"})})}),n.jsxs("div",{className:c.tableWrapper,children:[p==="initializing"&&n.jsx("div",{children:"초기화 중..."}),h&&n.jsx("div",{children:"로딩 중..."}),n.jsx("div",{ref:b,className:c.tableSection,style:{visibility:h||p!=="ready"?"hidden":"visible"}})]}),n.jsx(re,{show:G,onHide:q,onConfirm:W,title:"권한 선택",children:n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{htmlFor:"authIdSelect",className:"form-label",children:"권한"}),n.jsxs("select",{className:`form-select ${c.formSelect}`,id:"authIdSelect",value:z.AUTHID,onChange:r=>{const e=T.find(l=>l.AUTHID===r.target.value);x({AUTHID:r.target.value,AUTHNM:e?e.AUTHNM:""})},children:[n.jsx("option",{value:"",children:"선택하세요"}),T.map(r=>n.jsx("option",{value:r.AUTHID,children:r.AUTHNM},r.AUTHID))]})]})})]})};export{ge as default};
//# sourceMappingURL=UserAuthManage-B_EWM279.js.map
