import{r as n,j as t}from"./index-NQW_x_Sn.js";import{h as R,c as I}from"./tableExcel-h_9-hs2N.js";const B="_container_lrzjr_4",L="_topSearchArea_lrzjr_14",P="_dateFilterGroup_lrzjr_26",G="_dateLabel_lrzjr_32",W="_dateInput_lrzjr_39",O="_dateSeparator_lrzjr_48",k="_searchButton_lrzjr_54",H="_tableToolbar_lrzjr_72",U="_totalCount_lrzjr_80",$="_downloadExcelButton_lrzjr_86",J="_tableWrapper_lrzjr_102",X="_tableSection_lrzjr_114",Y="_message_lrzjr_120",Z="_errorMessage_lrzjr_127",r={container:B,topSearchArea:L,dateFilterGroup:P,dateLabel:G,dateInput:W,dateSeparator:O,searchButton:k,tableToolbar:H,totalCount:U,downloadExcelButton:$,tableWrapper:J,tableSection:X,message:Y,errorMessage:Z},q=50,V=()=>{const c=n.useRef(null),e=n.useRef(null),[u,b]=n.useState(!1),[m,d]=n.useState(null),[E,h]=n.useState(0),[s,p]=n.useState("initializing"),[o,N]=n.useState([]),_=new Date,S=new Date(_);S.setMonth(_.getMonth()-1);const j=a=>{const i=a.getFullYear(),z=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return`${i}-${z}-${l}`},[g,A]=n.useState(j(S)),[f,T]=n.useState(j(_)),w=n.useRef(!0),M=[{title:"No.",field:"id",hozAlign:"center",width:60,formatter:"rownum"},{title:"월",field:"MDATE",hozAlign:"center",headerFilter:!0,width:100},{title:"일자",field:"DDATE",hozAlign:"center",headerFilter:!0,width:120},{title:"사원번호",field:"EMPNO",hozAlign:"center",headerFilter:!0,width:120},{title:"이름",field:"EMPNM",hozAlign:"center",headerFilter:!0,width:120},{title:"사용자IP",field:"USERIP",hozAlign:"center",headerFilter:!0,width:150},{title:"구분(W/M)",field:"USERCONGB",hozAlign:"center",headerFilter:!0,width:100}];n.useEffect(()=>((async()=>{if(!c.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(e.current=I(c.current,[],M,{pagination:"local",paginationSize:10,paginationSizeSelector:[10,20,50,100,!0],layout:"fitColumns"}),!e.current)throw new Error("createTable 함수가 유효한 Tabulator 인스턴스를 반환하지 않았습니다.");p("ready"),await y()}catch(i){p("error"),console.error("테이블 초기화 실패:",i.message),d("테이블 초기화 중 오류가 발생했습니다.")}})(),()=>{e.current&&(e.current.destroy(),e.current=null,p("initializing"))}),[]),n.useEffect(()=>{if(!(!e.current||s!=="ready")){if(u){e.current.clearData(),h(0),e.current.alert("데이터 로딩 중...","loading");return}o.length===0?(e.current.clearData(),h(0),w.current?e.current.clearAlert():e.current.alert("검색 결과 없음","info")):(e.current.setData(o),e.current.clearAlert(),h(o.length)),w.current=!1}},[o,u,s]);const y=async()=>{if(!e.current||s!=="ready"){console.warn("테이블 인스턴스 또는 상태가 준비되지 않아 검색을 실행할 수 없습니다.");return}b(!0),d(null);try{const a=await fetch("http://localhost:5173/api/oper/loginHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({startDate:g,endDate:f})});if(!a.ok)throw new Error("API 요청 실패");let l=[...(await a.json()).data||[]];const v=new Date(g),x=new Date(f);x.setHours(23,59,59,999),l=l.filter(F=>{const D=new Date(F.DDATE);return D>=v&&D<=x});const C=l.slice(0,q);N(C)}catch(a){console.log("데이터 조회 오류:",a.message),d("데이터를 가져오는 중 오류가 발생했습니다.")}finally{b(!1)}};return t.jsxs("div",{className:r.container,children:[t.jsxs("div",{className:r.topSearchArea,children:[t.jsxs("div",{className:r.dateFilterGroup,children:[t.jsx("label",{htmlFor:"startDate",className:r.dateLabel,children:"기간"}),t.jsx("input",{type:"date",id:"startDate",className:r.dateInput,value:g,onChange:a=>A(a.target.value)}),t.jsx("span",{className:r.dateSeparator,children:"~"}),t.jsx("input",{type:"date",id:"endDate",className:r.dateInput,value:f,onChange:a=>T(a.target.value)})]}),t.jsx("button",{type:"button",className:r.searchButton,onClick:y,children:"조회"})]}),t.jsxs("div",{className:r.tableToolbar,children:[t.jsxs("span",{className:r.totalCount,children:["Total : ",E]}),t.jsx("button",{className:r.downloadExcelButton,onClick:()=>R(e.current,s,"로그인이력.xlsx"),children:"엑셀 다운로드"})]}),t.jsxs("div",{className:r.tableWrapper,children:[s==="initializing"&&t.jsx("div",{className:r.message,children:"테이블 초기화 중..."}),m&&t.jsx("div",{className:r.errorMessage,children:m}),t.jsx("div",{ref:c,className:r.tableSection,style:{visibility:u||s!=="ready"?"hidden":"visible"}})]})]})};export{V as default};
//# sourceMappingURL=MonthlyLoginHistory-Fjqc1AKj.js.map
