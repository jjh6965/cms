import{b as Ee,u as Ne,r as d,h as ue,j as s,d as v,f as H,c as _}from"./index-NQW_x_Sn.js";import{C as B}from"./CommonPopup-Dwp1i3fD.js";import{i as G,M as Ue,T as fe}from"./TableSearch-D0PWM4AW.js";import{h as Me,c as he}from"./tableExcel-h_9-hs2N.js";import{s as o}from"./TableSearch.module-DFltd_EQ.js";import{e as h}from"./errorMsgPopup-CX9GGfgq.js";import{m as me}from"./msgPopup-B5uV-LHr.js";import"./DatePickerCommon-MvAA8I6u.js";import"./react-datepicker-D9fc_BLh.js";import"./index-BBx72Rax.js";const W={editor:"input",editable:!0},pe={editor:"number",editorParams:{min:0},editable:!0},q=E=>({editor:"list",editorParams:{values:E,autocomplete:!0},editable:!0}),ge=(E,p,L)=>({formatter:g=>{const m=document.createElement("button");return m.className=`btn btn-sm ${p}`,m.innerText=E,m.onclick=()=>L(g.getData()),m}}),I=(E,p,L,g)=>{const m=E.getRow().getData().MENUID,D=E.getValue();if(p==="MENUNM"){const N=v.validateVarcharLength(D,100,"메뉴명");if(!N.valid){h(N.error);return}}else if(p==="URL"){const N=v.validateVarcharLength(D,250,"URL");if(!N.valid){h(N.error);return}}setTimeout(()=>{L(N=>N.map(x=>{if(String(x.MENUID)===String(m)){const M={...x,[p]:D};return M.isDeleted==="N"&&M.isAdded==="N"&&(M.isChanged="Y"),M}return x})),g.current&&g.current.redraw()},0)},De=(E,p,L)=>{const g=E.getRow().getData(),D=E.getTable().getData().find(N=>String(N.MENUID)===String(g.UPPERMENUID));return D?L(D.MENUNM,D.MENULEVEL):"없음"},Re=E=>({USEYN:[{value:"",label:"전체"},{value:"Y",label:"사용"},{value:"N",label:"미사용"}]})[E]||[],ye=()=>{const{user:E}=Ee(),p=Ne(),L={areas:[{type:"search",fields:[{id:"MENUNM",type:"text",row:1,label:"메뉴명",labelVisible:!0,placeholder:"메뉴명 검색",maxLength:100,width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0},{id:"USEYN",type:"select",row:1,label:"사용",labelVisible:!0,options:Re("USEYN"),width:"150px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0}]}]},g=[{id:"filterSelect",label:"",type:"select",options:[{value:"",label:"선택"},{value:"MENUNM",label:"메뉴명"},{value:"URL",label:"URL"},{value:"USEYN",label:"사용"}]},{id:"filterText",label:"",type:"text",placeholder:"찾을 내용을 입력하세요",width:"200px"}],[m,D]=d.useState(G(L.areas.find(e=>e.type==="search").fields)),[N,x]=d.useState(G(g)),[M,S]=d.useState(!1),[R,u]=d.useState([]),[$,J]=d.useState(!1),[Y,C]=d.useState("initializing"),[K,y]=d.useState(!1),[Q,j]=d.useState(!1),[P,w]=d.useState(null),[a,U]=d.useState({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"}),[X,Z]=d.useState(1),[ee,te]=d.useState(0),F=d.useRef(null),i=d.useRef(null),z=d.useRef(!0),V=(e,t)=>t<=1?e:`${"  ".repeat(t-1)}└${e}`,se=[{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업",field:"actions",width:80,visible:!0,...ge("삭제",`btn-danger ${o.deleteButton}`,e=>ce(e))},{frozen:!0,headerHozAlign:"center",hozAlign:"center",title:"작업대상",field:"applyTarget",sorter:"string",width:100,formatter:e=>{const t=e.getRow().getData();let r="",l="";if(t.isDeleted==="Y"?(r="삭제",l="isDeleted"):t.isAdded==="Y"?(r="추가",l="isAdded"):t.isChanged==="Y"&&(r="변경",l="isChanged"),!r)return"";const c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.gap="5px";const n=document.createElement("input");n.type="checkbox",n.checked=t[l]==="Y",n.onclick=()=>{setTimeout(()=>{u(T=>T.map(b=>{if(b.MENUID===t.MENUID){const O={...b,[l]:n.checked?"Y":"N"};return l==="isDeleted"&&!n.checked&&(O.isChanged="N"),l==="isAdded"&&!n.checked?null:O}return b}).filter(Boolean))},0)};const f=document.createElement("span");return f.innerText=r,c.appendChild(n),c.appendChild(f),c}},{headerHozAlign:"center",hozAlign:"center",title:"ID",field:"MENUID",sorter:"string",width:100},{headerHozAlign:"center",hozAlign:"left",title:"메뉴명",field:"MENUNM",sorter:"string",width:200,...W,cellEdited:e=>I(e,"MENUNM",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"상위메뉴",field:"UPPERMENUID",sorter:"string",width:120,formatter:e=>De(e,R,V),cellClick:(e,t)=>{w(t.getRow().getData().MENUID),U({...a,UPPERMENUID:t.getRow().getData().UPPERMENUID||""}),j(!0)}},{headerHozAlign:"center",hozAlign:"left",title:"URL",field:"URL",sorter:"string",width:300,...W,cellEdited:e=>I(e,"URL",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"레벨",field:"MENULEVEL",sorter:"number",width:80,editable:!1},{headerHozAlign:"center",hozAlign:"center",title:"하위포함",field:"LEAFMENUYN",sorter:"string",width:100,...q(["Y","N"]),cellEdited:e=>I(e,"LEAFMENUYN",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"순서",field:"MENUORDER",sorter:"number",width:80,...pe,cellEdited:e=>I(e,"MENUORDER",u,i)},{headerHozAlign:"center",hozAlign:"center",title:"사용",field:"USEYN",sorter:"string",width:80,...q(["Y","N"]),cellEdited:e=>I(e,"USEYN",u,i)}],k=async()=>{var e,t;S(!0),J(!0);try{const r={MENUNM:m.MENUNM||"",USEYN:m.USEYN||"",DEBUG:"F"},l=await H(_,`${v.getServerUrl("oper/menumng/list")}`,r);if(!l.success){h(l.message||"메뉴 데이터를 가져오는 중 오류가 발생했습니다."),u([]);return}if(l.errMsg!==""){h(l.errMsg),u([]);return}const c=Array.isArray(l.data)?l.data:[],n=c.map(f=>({...f,MENULEVEL:A(f,c),MENUORDER:Number(f.MENUORDER),isDeleted:"N",isEdited:"N",isAdded:"N"}));u(n)}catch(r){console.error("데이터 로드 실패:",r),h(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"메뉴 데이터를 가져오는 중 오류가 발생했습니다."),u([])}finally{S(!1)}},A=(e,t,r=new Set)=>{if(!e.UPPERMENUID||r.has(e.MENUID))return 1;r.add(e.MENUID);const l=t.find(c=>c.MENUID===e.UPPERMENUID);return l?A(l,t,r)+1:1};d.useEffect(()=>{(!E||!ue(E.auth,"menuManage"))&&p("/")},[E,p]),d.useEffect(()=>((async()=>{if(await new Promise(t=>setTimeout(t,1e3)),!F.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(i.current=he(F.current,se,[],{editable:!0,rowFormatter:t=>{const r=t.getData(),l=t.getElement();l.classList.remove(o.deletedRow,o.addedRow,o.editedRow),r.isDeleted==="Y"?l.classList.add(o.deletedRow):r.isAdded==="Y"?l.classList.add(o.addedRow):r.isChanged==="Y"&&l.classList.add(o.editedRow)}}),!i.current)throw new Error("createTable returned undefined or null");C("ready")}catch(t){C("error"),console.error("Table initialization failed:",t.message)}})(),()=>{i.current&&(i.current.destroy(),i.current=null,C("initializing"))}),[]),d.useEffect(()=>{var t;if(z.current){z.current=!1;return}const e=i.current;if(!(!e||Y!=="ready"||M))if((t=e.rowManager)!=null&&t.renderer)if(e.setData(R),$&&R.length===0&&!M)i.current.alert("검색 결과 없음","info");else{i.current.clearAlert();const r=i.current.getDataCount();te(r)}else console.warn("renderer가 아직 초기화되지 않았습니다.")},[R,M,Y,$]),d.useEffect(()=>{if(z.current||!i.current||Y!=="ready"||M)return;const{filterSelect:e,filterText:t}=N;t&&e?i.current.setFilter(e,"like",t):t?t!==""?i.current.setFilter([{field:"MENUNM",type:"like",value:t},{field:"URL",type:"like",value:t},{field:"USEYN",type:"like",value:t}],"or"):i.current.clearFilter():e&&i.current.clearFilter()},[N.filterSelect,N.filterText,Y,M]);const re=e=>{e==="search"&&k()},le=()=>{U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"}),y(!0)},ne=()=>{const e=v.validateVarcharLength(a.MENUNM,100,"메뉴명");if(!e.valid){h(e.error);return}const t=v.validateVarcharLength(a.URL,250,"URL");if(!t.valid){h(t.error);return}if(!a.MENUNM.trim()){h("메뉴명을 입력해주세요.");return}if(!a.MENUORDER||isNaN(a.MENUORDER)){h("메뉴 순서를 숫자로 입력해주세요.");return}const l={MENUID:`IMSI${String(X).padStart(4,"0")}`,MENUNM:a.MENUNM,UPPERMENUID:a.UPPERMENUID,URL:a.URL,MENULEVEL:a.MENULEVEL,LEAFMENUYN:a.LEAFMENUYN,MENUORDER:parseInt(a.MENUORDER),USEYN:a.USEYN,isDeleted:"N",isEdited:"N",isAdded:"Y"};u(c=>[l,...c]),Z(c=>c+1),y(!1),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},ae=()=>{y(!1),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},ie=()=>{if(!P)return;const e=a.UPPERMENUID,t=e?A({UPPERMENUID:e,MENUID:P},R):1;u(r=>r.map(l=>l.MENUID===P?{...l,UPPERMENUID:e,MENULEVEL:t,isChanged:l.isDeleted==="N"&&l.isAdded==="N"?"Y":l.isChanged}:l)),i.current&&i.current.redraw(),j(!1),w(null),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},oe=()=>{j(!1),w(null),U({MENUNM:"",UPPERMENUID:"",URL:"",MENULEVEL:"1",LEAFMENUYN:"Y",MENUORDER:"",USEYN:"Y"})},ce=e=>{setTimeout(()=>{if(e.isAdded==="Y")u(t=>t.filter(r=>r.MENUID!==e.MENUID));else{const t=e.isDeleted==="Y"?"N":"Y";u(r=>r.map(l=>l.MENUID===e.MENUID?{...l,isDeleted:t,isChanged:t==="Y"?"N":l.isChanged}:l))}},0)},de=async e=>{e.preventDefault();const t=R.filter(r=>r.isDeleted==="Y"&&r.isAdded!=="Y"||r.isAdded==="Y"||r.isChanged==="Y"&&r.isDeleted==="N");if(t.length===0){h("변경된 데이터가 없습니다.");return}S(!0);try{const r=t.map(async n=>{let f="";n.isDeleted==="Y"&&n.isAdded!=="Y"?f="D":n.isAdded==="Y"?f="I":n.isChanged==="Y"&&n.isDeleted==="N"&&(f="U");const T={pGUBUN:f,pMENUID:n.MENUID,pMENUNM:n.MENUNM||"",pUPPERMENUID:n.UPPERMENUID||"",pURL:n.URL||"",pMENULEVEL:String(n.MENULEVEL)||"1",pMENUORDER:String(n.MENUORDER)||"",pUSEYN:n.USEYN||"Y"};try{const b=await H(_,`${v.getServerUrl("oper/menumng/save")}`,T);if(!b.success)throw new Error(b.message||`Failed to ${f} menu ${n.MENUID}`);return{...n,success:!0}}catch(b){return console.error(`Error processing ${f} for MENUID: ${n.MENUID}`,b),{...n,success:!1,error:b.message}}}),c=(await Promise.all(r)).filter(n=>!n.success);c.length>0?h(`일부 작업이 실패했습니다: ${c.map(n=>n.error).join(", ")}`):(me("모든 변경사항이 성공적으로 저장되었습니다."),await k())}catch(r){console.error("Save operation failed:",r),h(r.message||"저장 중 오류가 발생했습니다.")}finally{S(!1)}};return s.jsxs("div",{className:o.container,children:[s.jsx(Ue,{config:L,filters:m,setFilters:D,onEvent:re}),s.jsx(fe,{filterFields:g,filters:N,setFilters:x,rowCount:ee,onDownloadExcel:()=>Me(i.current,Y,"메뉴관리.xlsx"),buttonStyles:o,children:s.jsxs("div",{className:o.btnGroupCustom,children:[s.jsx("button",{className:`${o.btn} text-bg-primary`,onClick:le,children:"추가"}),s.jsx("button",{className:`${o.btn} text-bg-success`,onClick:de,children:"저장"})]})}),s.jsxs("div",{className:o.tableWrapper,children:[Y==="initializing"&&s.jsx("div",{children:"초기화 중..."}),M&&s.jsx("div",{children:"로딩 중..."}),s.jsx("div",{ref:F,className:o.tableSection,style:{visibility:M||Y!=="ready"?"hidden":"visible"}})]}),s.jsxs(B,{show:K,onHide:ae,onConfirm:ne,title:"메뉴 추가",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"메뉴명"}),s.jsx("input",{type:"text",className:`form-control ${o.formControl}`,value:a.MENUNM,onChange:e=>U({...a,MENUNM:e.target.value}),placeholder:"메뉴명을 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"상위메뉴"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.UPPERMENUID,onChange:e=>{const t=e.target.value,r=t?A({UPPERMENUID:t,MENUID:"temp"},R):1;U({...a,UPPERMENUID:t,MENULEVEL:String(r)})},children:[s.jsx("option",{value:"",children:"없음"}),R.filter(e=>e.MENUID!==a.MENUID).map(e=>s.jsx("option",{value:e.MENUID,children:V(e.MENUNM,e.MENULEVEL)},e.MENUID))]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"URL"}),s.jsx("input",{type:"text",className:`form-control ${o.formControl}`,value:a.URL,onChange:e=>U({...a,URL:e.target.value}),placeholder:"URL을 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"메뉴순서"}),s.jsx("input",{type:"number",className:`form-control ${o.formControl}`,value:a.MENUORDER,onChange:e=>U({...a,MENUORDER:e.target.value}),placeholder:"메뉴 순서를 입력하세요"})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"하위포함"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.LEAFMENUYN,onChange:e=>U({...a,LEAFMENUYN:e.target.value}),children:[s.jsx("option",{value:"Y",children:"Y"}),s.jsx("option",{value:"N",children:"N"})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"사용"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.USEYN,onChange:e=>U({...a,USEYN:e.target.value}),children:[s.jsx("option",{value:"Y",children:"Y"}),s.jsx("option",{value:"N",children:"N"})]})]})]}),s.jsx(B,{show:Q,onHide:oe,onConfirm:ie,title:"상위메뉴 선택",children:s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"상위메뉴"}),s.jsxs("select",{className:`form-select ${o.formSelect}`,value:a.UPPERMENUID,onChange:e=>U({...a,UPPERMENUID:e.target.value}),children:[s.jsx("option",{value:"",children:"없음"}),R.filter(e=>e.MENUID!==P).map(e=>s.jsx("option",{value:e.MENUID,children:V(e.MENUNM,e.MENULEVEL)},e.MENUID))]})]})})]})};export{ye as default};
//# sourceMappingURL=MenuManageInfo-eslWPZi6.js.map
