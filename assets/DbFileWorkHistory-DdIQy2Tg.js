import{b as U,u as j,r,h as $,j as c,f as W,c as G,d as J}from"./index-NQW_x_Sn.js";import{i as S,M as _,T as V}from"./TableSearch-D0PWM4AW.js";import{h as L,c as Y}from"./tableExcel-h_9-hs2N.js";import{s as A}from"./TableSearch.module-DFltd_EQ.js";import"./DatePickerCommon-MvAA8I6u.js";import"./react-datepicker-D9fc_BLh.js";import"./index-BBx72Rax.js";import"./errorMsgPopup-CX9GGfgq.js";const le=()=>{const{user:u}=U(),x=j(),[h,v]=r.useState({}),[g,y]=r.useState({}),[d,p]=r.useState([]),[a,T]=r.useState(!1),[E,D]=r.useState(!1),[i,O]=r.useState("initializing"),[P,R]=r.useState(null),[B,z]=r.useState(0),m=r.useRef(null),l=r.useRef(null),b=r.useRef(!0),k=r.useRef(h),f=new Date,M=`${f.getFullYear()}-${(f.getMonth()+1).toString().padStart(2,"0")}`,N={areas:[{type:"search",fields:[{id:"month",type:"select",row:1,label:"월 선택",labelVisible:!0,options:[{value:M,label:M},...Array.from({length:f.getMonth()},(t,e)=>{const n=(f.getMonth()-e).toString().padStart(2,"0");return{value:`2025-${n}`,label:`2025-${n}`}}),...Array.from({length:12-f.getMonth()-1},(t,e)=>{const n=(f.getMonth()+1+e+1).toString().padStart(2,"0");return{value:`2025-${n}`,label:`2025-${n}`}})].filter((t,e,n)=>e===n.findIndex(s=>s.value===t.value)),width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0,defaultValue:M}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0,labelVisible:!1}]}]},w=[{id:"filterSelect",type:"select",label:"",options:[{value:"",label:"선택"},{value:"MONTH",label:"월"},{value:"DATE",label:"일자"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"USERIP",label:"사용자IP"},{value:"USERCONGB",label:"구분(Web/Mobile)"},{value:"JOBNM",label:"작업명"}],width:"default",height:"default",backgroundColor:"default",color:"default",enabled:!0},{id:"filterText",type:"text",label:"",placeholder:"찾을 내용을 입력하세요",width:"default",height:"default",backgroundColor:"default",color:"default",enabled:!0}],C=[{title:"월",field:"MONTH",width:100,headerHozAlign:"center",hozAlign:"center"},{title:"일자",field:"DATE",width:150,headerHozAlign:"center",hozAlign:"center"},{title:"사원번호",field:"EMPNO",width:120,headerHozAlign:"center",hozAlign:"center"},{title:"이름",field:"EMPNM",width:120,headerHozAlign:"center",hozAlign:"center"},{title:"사용자IP",field:"USERIP",width:150,headerHozAlign:"center",hozAlign:"center"},{title:"구분(Web/Mobile)",field:"USERCONGB",width:150,headerHozAlign:"center",hozAlign:"center",formatter:t=>{const e=t.getValue();return e==="W"?"Web":e==="M"?"Mobile":e}},{title:"작업명",field:"JOBNM",width:300,headerHozAlign:"center",hozAlign:"left"}];r.useEffect(()=>{(!u||!$(u.auth,"dbWorkHistory"))&&x("/"),v(S(N.areas[0].fields)),y(S(w))},[u,x]),r.useEffect(()=>{k.current=h},[h]);const H=async(t=M)=>{T(!0),D(!0),R(null);const n={pMDATE:k.current.month.replace("-",""),pDEBUG:"F"};console.log("Fetching data with params:",n);try{const s=await W(G,`${J.getServerUrl("history/dbwork/list")}`,n,{method:"POST",headers:{Authorization:`Bearer ${u==null?void 0:u.token}`}});if(console.log("Raw API Response:",s),!s.success||s.errMsg!==""){p([]);return}const I=(s.data||[]).map(o=>({MONTH:o.MONTH||"",DATE:o.DATE?o.DATE.substring(0,10):"",EMPNO:o.EMPNO||"",EMPNM:o.EMPNM||"",USERIP:o.USERIP||"",USERCONGB:o.USERCONGB||"",JOBNM:o.JOBNM||""}));p(I)}catch(s){console.error("데이터 로드 실패:",s),p([])}finally{T(!1)}};r.useEffect(()=>{var e;if(b.current){b.current=!1;return}const t=l.current;!t||i!=="ready"||a||((e=t.rowManager)!=null&&e.renderer?(t.setData(d),E&&d.length===0&&!a?t.clearData():(t.clearAlert(),z(t.getDataCount()))):console.warn("renderer가 아직 초기화되지 않았습니다."))},[d,a,i,E]);const F=t=>{t==="search"?H(h.month):t==="reset"&&(v(S(N.areas[0].fields)),y(S(w)),p([]),D(!1))};return r.useEffect(()=>((async()=>{if(await new Promise(e=>setTimeout(e,1e3)),!!m.current)try{l.current=Y(m.current,C,[],{}),O("ready")}catch(e){O("error"),R("테이블 초기화 실패: "+e.message)}})(),()=>{var e;return(e=l.current)==null?void 0:e.destroy()}),[]),r.useEffect(()=>{var e;if(b.current){b.current=!1;return}const t=l.current;!t||i!=="ready"||a||((e=t.rowManager)!=null&&e.renderer?(t.setData(d),E&&d.length===0&&!a?l.current.alert("검색 결과 없음","info"):(l.current.clearAlert(),z(t.getDataCount()))):console.warn("renderer가 아직 초기화되지 않았습니다."))},[d,a,i,E]),r.useEffect(()=>{if(b.current||!l.current||i!=="ready"||a)return;const{filterSelect:t,filterText:e}=g;e&&t?l.current.setFilter(t,"like",e):e?l.current.setFilter([{field:"MONTH",type:"like",value:e},{field:"DATE",type:"like",value:e},{field:"EMPNO",type:"like",value:e},{field:"EMPNM",type:"like",value:e},{field:"USERIP",type:"like",value:e},{field:"USERCONGB",type:"like",value:e},{field:"JOBNM",type:"like",value:e}],"or"):l.current.clearFilter()},[g.filterSelect,g.filterText,i,a]),c.jsxs("div",{className:A.container,children:[P&&c.jsx("div",{children:P}),c.jsx(_,{config:N,filters:h,setFilters:v,onEvent:F}),c.jsx(V,{filterFields:w,filters:g,setFilters:y,onDownloadExcel:()=>L(l.current,i,"월별_DB_작업_이력.xlsx"),rowCount:B,onEvent:F}),c.jsxs("div",{className:A.tableWrapper,children:[i==="initializing"&&c.jsx("div",{children:"초기화 중..."}),a&&c.jsx("div",{children:"로딩 중..."}),c.jsx("div",{ref:m,className:A.tableSection,style:{visibility:a||i!=="ready"?"hidden":"visible"}})]})]})};export{le as default};
//# sourceMappingURL=DbFileWorkHistory-DdIQy2Tg.js.map
