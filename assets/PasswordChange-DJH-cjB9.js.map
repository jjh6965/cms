{"version":3,"file":"PasswordChange-DJH-cjB9.js","sources":["../../src/pages/user/PasswordChange.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport commonUtils from '../../utils/common.js';\nimport { fetchData } from '../../utils/dataUtils';\nimport api from '../../utils/api';\nimport common from '../../utils/common';\nimport { msgPopup } from '../../utils/msgPopup';\nimport styles from './Join.module.css';\n\nconst PasswordChange = ({ show, onHide, initialEmpNo, isEditable }) => {\n  const [empNo, setEmpNo] = useState(initialEmpNo || '');\n  const [currentPwd, setCurrentPwd] = useState('');\n  const [newPwd, setNewPwd] = useState('');\n  const [confirmPwd, setConfirmPwd] = useState('');\n  const [error, setError] = useState('');\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (show) {\n      setEmpNo(initialEmpNo || '');\n      setCurrentPwd('');\n      setNewPwd('');\n      setConfirmPwd('');\n      setError('');\n    }\n  }, [show, initialEmpNo]);\n\n  const validateForm = () => {\n    if (!empNo || !currentPwd || !newPwd || !confirmPwd) {\n      return \"필수 입력 항목을 모두 채워주세요.\";\n    }\n\n    const empNoValidation = commonUtils.validateVarcharLength(empNo, 20, '아이디');\n    if (!empNoValidation.valid) return empNoValidation.error;\n\n    if (newPwd.length < 6) {\n      return \"새 비밀번호는 최소 6자 이상이어야 합니다.\";\n    }\n\n    if (newPwd !== confirmPwd) {\n      return \"새 비밀번호와 확인 비밀번호가 일치하지 않습니다.\";\n    }\n\n    if (currentPwd === newPwd) {\n      return \"현재 비밀번호와 새 비밀번호가 동일할 수 없습니다.\";\n    }\n\n    return '';\n  };\n\n  const handlePasswordChange = async (e) => {\n    e.preventDefault();\n    setError('');\n\n    const validationError = validateForm();\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    try {\n      const params = {\n          pEMPNO: empNo,\n          pEMPPWD: currentPwd,\n          pDEBUG: \"F\"\n        };\n\n      const checkResponse = await fetchData(\n        api,\n        `${common.getServerUrl('auth/password/list')}`,\n        params\n      );\n\n      if (!checkResponse.success || !checkResponse.data) {\n        setError(\"입력한 비밀번호와 현재 비밀번호가 다릅니다.\");\n        return;\n      }\n\n      // If the current password is correct, proceed with saving the new password\n      const userData = {\n        pGUBUN: 'U',\n        pEMPNO: empNo,\n        pEMPPWD: newPwd\n      };\n\n      const saveResponse = await fetchData(\n        api,\n        `${common.getServerUrl('auth/password/save')}`,\n        userData\n      );\n\n      if (!saveResponse.success) {\n        throw new Error(saveResponse.errMsg || '비밀번호 변경에 실패했습니다.');\n      } else {\n        if (saveResponse.errMsg !== '') {\n          setError(saveResponse.errMsg);\n        } else {\n          msgPopup(\"비밀번호가 성공적으로 변경되었습니다.\");\n          navigate('/login');\n          onHide();\n        }\n      }\n    } catch (error) {\n      console.error('Password change error:', error.message);\n      setError(error.message || '비밀번호 변경 중 오류가 발생했습니다. 다시 시도해주세요.');\n    }\n  };\n\n  if (!show) return null;\n\n  return (\n    <>\n      <div className={styles.overlay} onClick={onHide}></div>\n      <div className={`${styles.modal} show d-block`} tabIndex=\"-1\">\n        <div className={`${styles.modalDialog} modal-dialog-centered`}>\n          <div className={`${styles.modalContent} modal-content`}>\n            <div className={`${styles.modalHeader} modal-header`}>\n              <h5 className={`${styles.modalTitle} modal-title`}>비밀번호 변경</h5>\n              <button type=\"button\" className={`${styles.btnClose} btn-close`} onClick={onHide}></button>\n            </div>\n            <div className={`${styles.modalBody} modal-body`}>\n              <form onSubmit={handlePasswordChange}>\n                <div className={styles.formRow}>\n                  <div className={styles.formGroup}>\n                    <label htmlFor=\"empNo\" className=\"form-label\">\n                      <i className=\"bi bi-person me-2\"></i>아이디 <i className=\"bi bi-asterisk text-danger\"></i>\n                    </label>\n                    <input\n                      type=\"text\"\n                      className=\"form-control\"\n                      id=\"empNo\"\n                      value={empNo}\n                      onChange={(e) => isEditable && setEmpNo(e.target.value)} // Editable based on isEditable\n                      disabled={!isEditable} // Non-editable if triggered by pwdChgYn\n                      placeholder=\"아이디를 입력하세요\"\n                    />\n                  </div>\n                  <div className={styles.formGroup}>\n                    <label htmlFor=\"currentPwd\" className=\"form-label\">\n                      <i className=\"bi bi-lock me-2\"></i>현재 비밀번호 <i className=\"bi bi-asterisk text-danger\"></i>\n                    </label>\n                    <input\n                      type=\"password\"\n                      className=\"form-control\"\n                      id=\"currentPwd\"\n                      value={currentPwd}\n                      onChange={(e) => setCurrentPwd(e.target.value)}\n                      required\n                      placeholder=\"현재 비밀번호를 입력하세요\"\n                    />\n                  </div>\n                  <div className={styles.formGroup}>\n                    <label htmlFor=\"newPwd\" className=\"form-label\">\n                      <i className=\"bi bi-lock-fill me-2\"></i>새 비밀번호 <i className=\"bi bi-asterisk text-danger\"></i>\n                    </label>\n                    <input\n                      type=\"password\"\n                      className=\"form-control\"\n                      id=\"newPwd\"\n                      value={newPwd}\n                      onChange={(e) => setNewPwd(e.target.value)}\n                      required\n                      placeholder=\"새 비밀번호를 입력하세요\"\n                    />\n                  </div>\n                  <div className={styles.formGroup}>\n                    <label htmlFor=\"confirmPwd\" className=\"form-label\">\n                      <i className=\"bi bi-lock-fill me-2\"></i>비밀번호 확인 <i className=\"bi bi-asterisk text-danger\"></i>\n                    </label>\n                    <input\n                      type=\"password\"\n                      className=\"form-control\"\n                      id=\"confirmPwd\"\n                      value={confirmPwd}\n                      onChange={(e) => setConfirmPwd(e.target.value)}\n                      required\n                      placeholder=\"새 비밀번호를 다시 입력하세요\"\n                    />\n                  </div>\n                </div>\n                <button type=\"submit\" className={`${styles.btn} w-100 mt-3`}>\n                  <i className=\"bi bi-check-circle me-2\"></i>변경\n                </button>\n                {error && <p className=\"text-danger text-center mt-2\">{error}</p>}\n              </form>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default PasswordChange;"],"names":["PasswordChange","show","onHide","initialEmpNo","isEditable","empNo","setEmpNo","useState","currentPwd","setCurrentPwd","newPwd","setNewPwd","confirmPwd","setConfirmPwd","error","setError","navigate","useNavigate","useEffect","validateForm","empNoValidation","commonUtils","handlePasswordChange","e","validationError","params","checkResponse","fetchData","api","common","userData","saveResponse","msgPopup","jsxs","Fragment","jsx","styles"],"mappings":"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"}