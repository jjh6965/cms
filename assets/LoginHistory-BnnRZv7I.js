import{b as $,u as L,r,h as _,j as i,d as H,f as G,c as W}from"./index-NQW_x_Sn.js";import{i as p,M as B,T as V}from"./TableSearch-D0PWM4AW.js";import{h as Q,c as Y}from"./tableExcel-h_9-hs2N.js";import{s as w}from"./TableSearch.module-DFltd_EQ.js";import"./DatePickerCommon-MvAA8I6u.js";import"./react-datepicker-D9fc_BLh.js";import"./index-BBx72Rax.js";import"./errorMsgPopup-CX9GGfgq.js";const le=()=>{const{user:c}=$(),x=L(),[h,y]=r.useState({}),[g,S]=r.useState({}),[s,N]=r.useState(!1),[E,u]=r.useState([]),[P,D]=r.useState(!1),[o,v]=r.useState("initializing"),[R,z]=r.useState(null),[k,j]=r.useState(0),M=r.useRef(null),a=r.useRef(null),T=r.useRef(!0),F=r.useRef(h),d=new Date,b=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}`,A={areas:[{type:"search",fields:[{id:"month",type:"select",row:1,label:"월 선택",labelVisible:!0,options:[{value:b,label:b},...Array.from({length:d.getMonth()},(t,e)=>{const l=(d.getMonth()-e).toString().padStart(2,"0");return{value:`2025-${l}`,label:`2025-${l}`}}),...Array.from({length:12-d.getMonth()-1},(t,e)=>{const l=(d.getMonth()+1+e+1).toString().padStart(2,"0");return{value:`2025-${l}`,label:`2025-${l}`}})].filter((t,e,l)=>e===l.findIndex(f=>f.value===t.value)),width:"200px",height:"30px",backgroundColor:"#ffffff",color:"#000000",enabled:!0,defaultValue:b}]},{type:"buttons",fields:[{id:"searchBtn",type:"button",row:1,label:"검색",eventType:"search",width:"80px",height:"30px",backgroundColor:"#00c4b4",color:"#ffffff",enabled:!0,labelVisible:!1}]}]},m=[{id:"filterSelect",type:"select",label:"",options:[{value:"",label:"선택"},{value:"MONTH",label:"월"},{value:"DATE",label:"일자"},{value:"EMPNO",label:"사원번호"},{value:"EMPNM",label:"이름"},{value:"USERIP",label:"사용자IP"},{value:"LOGIN_STATUS",label:"구분(Web/Mobile)"}],width:"default",height:"default",backgroundColor:"default",color:"default",enabled:!0},{id:"filterText",type:"text",label:"",placeholder:"찾을 내용을 입력하세요",width:"default",height:"default",backgroundColor:"default",color:"default",enabled:!0}];r.useEffect(()=>{y(p(A.areas.find(t=>t.type==="search").fields)),S(p(m))},[]),r.useEffect(()=>{F.current=h},[h]),r.useEffect(()=>{(!c||!_(c.auth,"loginHistory"))&&x("/")},[c,x]);const I=[{title:"월",field:"MONTH",width:100,headerHozAlign:"center",hozAlign:"center"},{title:"일자",field:"DATE",width:150,headerHozAlign:"center",hozAlign:"center"},{title:"사원번호",field:"EMPNO",width:120,headerHozAlign:"center",hozAlign:"center"},{title:"이름",field:"EMPNM",width:120,headerHozAlign:"center",hozAlign:"center"},{title:"사용자IP",field:"USERIP",width:150,headerHozAlign:"center",hozAlign:"center"},{title:"구분(Web/Mobile)",field:"LOGIN_STATUS",width:150,headerHozAlign:"center",hozAlign:"center",formatter:t=>{const e=t.getValue();return e==="W"?"Web":e==="M"?"Mobile":e}}];I.map(t=>({id:t.field,label:t.title,type:"text",width:t.width,enabled:!0}));const C=async()=>{N(!0),D(!0),z(null);const e={pMDATE:F.current.month||b.replace("-",""),pDEBUG:"F"};console.log("Fetching data with params:",e),console.log("Full API URL:",`${H.getServerUrl("history/login/list")}`);try{const l=await G(W,`${H.getServerUrl("history/login/list")}`,e,{method:"POST",headers:{Authorization:`Bearer ${c==null?void 0:c.token}`}});if(console.log("Raw API Response:",l),!l.success){u([]);return}if(l.errMsg!==""){u([]);return}const f=l.data||[];if(!Array.isArray(f)){console.error("응답 데이터가 배열이 아님:",f),u([]);return}const U=f.map(n=>n.vQuery?(console.warn("Received vQuery instead of data:",n.vQuery),{}):{MONTH:n.MONTH||"",DATE:n.DATE?n.DATE.substring(0,10):"",EMPNO:n.EMPNO||"",EMPNM:n.EMPNM||"",USERIP:n.USERIP||"",LOGIN_STATUS:n.USERCONGB||""});u(U),console.log("Mapped data:",U)}catch(l){console.error("데이터 로드 실패:",l),u([])}finally{N(!1)}},O=t=>{t==="search"?C():t==="reset"&&(y(p(A.areas.find(e=>e.type==="search").fields)),S(p(m)),u([]),D(!1))};return r.useEffect(()=>((async()=>{if(await new Promise(e=>setTimeout(e,1e3)),!M.current){console.warn("테이블 컨테이너가 준비되지 않았습니다.");return}try{if(a.current=Y(M.current,I,[],{}),!a.current)throw new Error("createTable returned undefined or null");v("ready")}catch(e){v("error"),console.error("테이블 초기화 실패: ",e.message),z("테이블 초기화 중 오류 발생: "+e.message)}})(),()=>{a.current&&(a.current.destroy(),a.current=null,v("initializing"))}),[]),r.useEffect(()=>{if(T.current||!a.current||o!=="ready"||s)return;const{filterSelect:t,filterText:e}=g;e&&t?a.current.setFilter(t,"like",e):e?a.current.setFilter([{field:"MONTH",type:"like",value:e},{field:"DATE",type:"like",value:e},{field:"EMPNO",type:"like",value:e},{field:"EMPNM",type:"like",value:e},{field:"USERIP",type:"like",value:e},{field:"LOGIN_STATUS",type:"like",value:e}],"or"):a.current.clearFilter()},[g.filterSelect,g.filterText,o,s]),r.useEffect(()=>{var e;if(T.current){T.current=!1;return}const t=a.current;!t||o!=="ready"||s||((e=t.rowManager)!=null&&e.renderer?(t.setData(E),P&&E.length===0&&!s?t.clearData():(t.clearAlert(),j(t.getDataCount()))):console.warn("renderer가 아직 초기화되지 않았습니다."))},[E,s,o,P]),i.jsxs("div",{className:w.container,children:[R&&i.jsx("div",{children:R}),i.jsx(B,{config:A,filters:h,setFilters:y,onEvent:O}),i.jsx(V,{filterFields:m,filters:g,setFilters:S,onDownloadExcel:()=>Q(a.current,o,"로그인_이력.xlsx"),rowCount:k,onEvent:O}),i.jsxs("div",{className:w.tableWrapper,children:[o==="initializing"&&i.jsx("div",{children:"초기화 중..."}),s&&i.jsx("div",{children:"로딩 중..."}),i.jsx("div",{ref:M,className:w.tableSection,style:{visibility:s||o!=="ready"?"hidden":"visible"}})]})]})};export{le as default};
//# sourceMappingURL=LoginHistory-BnnRZv7I.js.map
