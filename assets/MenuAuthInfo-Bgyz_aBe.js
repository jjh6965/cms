import{b as V,u as W,r as g,h as q,f as Y,c as R,d as S,j as r}from"./index-NQW_x_Sn.js";import{e as m}from"./errorMsgPopup-CX9GGfgq.js";import{m as z}from"./msgPopup-B5uV-LHr.js";const J="_container_19kg4_1",K="_textLeft_19kg4_5",O="_stickyColumn_19kg4_12",Q="_stickyColumn2_19kg4_20",X="_textCenter_19kg4_28",Z="_tableResponsive_19kg4_33",ee="_table_19kg4_33",se="_stickyTop_19kg4_56",ne="_formCheckInput_19kg4_68",te="_formCheckInline_19kg4_72",ce="_changedCell_19kg4_76",ae="_btnReg_19kg4_80",re="_btnCancel_19kg4_87",l={container:J,textLeft:K,stickyColumn:O,stickyColumn2:Q,textCenter:X,tableResponsive:Z,table:ee,stickyTop:se,formCheckInput:ne,formCheckInline:te,changedCell:ce,btnReg:ae,btnCancel:re},de=()=>{const{user:A}=V(),b=W(),[d,f]=g.useState([]),[E,M]=g.useState([]),[N,k]=g.useState([]),[y,C]=g.useState(new Map),[_,j]=g.useState(!1);g.useEffect(()=>{if(!A||!q(A.auth,"menuAuth")){b("/");return}D()},[A,b]);const T=(e,s,a=new Set)=>{if(!e.UPPERMENUID||a.has(e.MENUID))return 1;a.add(e.MENUID);const n=s.find(t=>t.MENUID===e.UPPERMENUID);return n?T(n,s,a)+1:1},D=async()=>{var s,a;const e={param1:"F"};try{const n=await Y(R,`${S.getServerUrl("oper/menuauthinfo/list")}`,e);if(n.success){if(n.errMsg!==""){m(n.errMsg),f([]),M([]),k([]);return}}else{m(n.message||"메뉴 권한 데이터를 가져오는 중 오류가 발생했습니다."),f([]),M([]),k([]);return}const t=Array.isArray(n.data)?n.data:[],i=t.length>0&&Array.isArray(t[0].children)?t[0].children.map(o=>o.AUTHNM):[],c=t.map(o=>({...o,MENULEVEL:T(o,t)}));t.every(o=>Array.isArray(o.children)&&o.children.map(u=>u.AUTHNM).join(",")===i.join(","))||console.warn("Warning: Inconsistent AUTHNM order across menu items"),f(c),M(c),k(i),C(new Map)}catch(n){console.error("메뉴 권한 데이터 조회 실패:",{message:n.message,response:n.response?{status:n.response.status,data:n.response.data,headers:n.response.headers}:"No response received"}),m(((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"메뉴 권한 데이터를 가져오는 중 오류가 발생했습니다."),f([]),M([]),k([])}},L=(e,s)=>s===1?e:`${"  ".repeat(s-2)}└${e}`,I=(e,s)=>{const a=e.children.find(n=>n.AUTHNM===s);return a?a.AUTHYN:"N"},x=(e,s,a)=>({...e,children:e.children.map(n=>n.AUTHNM===s?{...n,AUTHYN:a}:n)}),P=(e,s)=>{const a=d.find(c=>c.MENUID===e),n=E.find(c=>c.MENUID===e);if(!a||!n)return!1;const t=a.children.find(c=>c.AUTHNM===s),i=n.children.find(c=>c.AUTHNM===s);return t&&i&&t.AUTHYN!==i.AUTHYN},H=e=>N.some(s=>y.has(`${e}-${s}`)),v=(e,s,a)=>{f(n=>n.map(t=>t.MENUID===e?x(t,s,a):t)),C(n=>{const t=new Map(n),i=`${e}-${s}`,p=d.map(h=>h.MENUID===e?x(h,s,a):h).find(h=>h.MENUID===e),o=E.find(h=>h.MENUID===e);if(!p||!o)return t;const u=p.children.find(h=>h.AUTHNM===s),$=o.children.find(h=>h.AUTHNM===s);return u&&$&&u.AUTHYN!==$.AUTHYN?t.set(i,!0):t.delete(i),t})},w=(e,s)=>{f(a=>a.map(n=>x(n,e,s?"Y":"N"))),C(a=>{const n=new Map(a);return d.forEach(t=>{const i=`${t.MENUID}-${e}`,c=E.find(U=>U.MENUID===t.MENUID);if(!c)return;const o=x(t,e,s?"Y":"N").children.find(U=>U.AUTHNM===e),u=c.children.find(U=>U.AUTHNM===e);o&&u&&o.AUTHYN!==u.AUTHYN?n.set(i,!0):n.delete(i)}),n})},F=()=>{D(),C(new Map)},B=e=>{C(s=>{const a=new Map(s);return N.some(t=>a.has(`${e}-${t}`))&&N.forEach(t=>{const i=`${e}-${t}`;a.has(i)?a.delete(i):P(e,t)&&a.set(i,!0)}),a})},G=async e=>{e.preventDefault();const s=[],a=new Set;if(y.forEach((n,t)=>{const[i,c]=t.split("-");if(H(i)){a.add(i);const p=d.find(o=>o.MENUID===i);if(p){const o=p.children.find(u=>u.AUTHNM===c);o&&s.push({pGUBUN:"U",pAUTHID:o.AUTHID,pMENUID:p.MENUID,pUSEYN:o.AUTHYN})}}}),s.length===0){m("변경된 데이터가 없습니다.");return}j(!0);try{const n=s.map(async c=>{const p={pGUBUN:c.pGUBUN,pAUTHID:c.pAUTHID,pMENUID:c.pMENUID,pUSEYN:c.pUSEYN};try{const o=await Y(R,`${S.getServerUrl("oper/menuauthinfo/save")}`,p);if(!o.success)throw new Error(o.message||`Failed to update menu auth ${c.pMENUID}-${c.pAUTHID}`);return{...c,success:!0}}catch(o){return console.error(`Error processing update for MENUID: ${c.pMENUID}, AUTHID: ${c.pAUTHID}`,o),{...c,success:!1,error:o.message}}}),i=(await Promise.all(n)).filter(c=>!c.success);i.length>0?m(`일부 작업이 실패했습니다: ${i.map(c=>c.error).join(", ")}`):(z("모든 변경사항이 성공적으로 저장되었습니다."),await D())}catch(n){console.error("Save operation failed:",n),m(n.message||"저장 중 오류가 발생했습니다.")}finally{j(!1)}};return r.jsxs("div",{className:`container mt-1 ${l.container}`,children:[r.jsxs("div",{className:"btn-group-custom d-flex justify-content-end gap-2 mb-3",children:[r.jsx("button",{className:`"btn text-bg-secondary" ${l.btnCancel}`,onClick:F,children:"초기화"}),r.jsx("button",{className:`"btn text-bg-success ${l.btnReg}`,onClick:G,disabled:_,children:_?"저장 중...":"저장"})]}),r.jsx("div",{className:`table-responsive ${l.tableResponsive}`,children:r.jsxs("table",{className:`table table-bordered ${l.table}`,children:[r.jsx("thead",{className:l.stickyTop,children:r.jsxs("tr",{children:[r.jsx("th",{className:`${l.textCenter} ${l.stickyColumn}`,children:"목차관리"}),r.jsx("th",{className:`${l.textCenter} ${l.stickyColumn2}`,children:"작업대상"}),N.map(e=>r.jsxs("th",{className:l.textCenter,children:[e,r.jsx("div",{className:"form-check d-flex justify-content-center mt-1",children:r.jsx("input",{type:"checkbox",className:l.formCheckInput,onChange:s=>w(e,s.target.checked),checked:Array.isArray(d)&&d.length>0&&d.every(s=>I(s,e)==="Y"),disabled:!Array.isArray(d)||d.length===0})})]},e))]})}),r.jsx("tbody",{children:Array.isArray(d)&&d.length>0?d.map(e=>r.jsxs("tr",{children:[r.jsx("td",{className:`${l.textLeft} ${l.stickyColumn}`,children:r.jsx("span",{children:L(e.MENUNM,e.MENULEVEL)})}),r.jsx("td",{className:`${l.textCenter} ${l.stickyColumn2}`,children:r.jsx("input",{type:"checkbox",className:l.formCheckInput,checked:H(e.MENUID),onChange:()=>B(e.MENUID)})}),N.map(s=>r.jsx("td",{className:`${l.textCenter} ${y.has(`${e.MENUID}-${s}`)?l.changedCell:""}`,children:r.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[r.jsxs("div",{className:`form-check form-check-inline ${l.formCheckInline}`,children:[r.jsx("input",{type:"radio",className:l.formCheckInput,name:`${s}-${e.MENUID}`,value:"Y",checked:I(e,s)==="Y",onChange:()=>v(e.MENUID,s,"Y")}),r.jsx("label",{className:"form-check-label",children:"Y"})]}),r.jsxs("div",{className:`form-check form-check-inline ${l.formCheckInline}`,children:[r.jsx("input",{type:"radio",className:l.formCheckInput,name:`${s}-${e.MENUID}`,value:"N",checked:I(e,s)==="N",onChange:()=>v(e.MENUID,s,"N")}),r.jsx("label",{className:"form-check-label",children:"N"})]})]})},s))]},e.MENUID)):r.jsx("tr",{children:r.jsx("td",{colSpan:N.length+2,className:l.textCenter,children:"데이터가 없습니다."})})})]})})]})};export{de as default};
//# sourceMappingURL=MenuAuthInfo-Bgyz_aBe.js.map
